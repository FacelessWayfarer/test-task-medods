# Medos test task
## Запуск приложения 
Чтобы запустить тестовое задание, введите следующие команды в командную строку:
```
git clone https://github.com/FacelessWayfarer/test-task-medods.git
cd test-task-medods
docker-compose up --build -d
```
__Обратите внимание__, что для запуска на машине должен быть установлен __docker-compose__. Приложение развернётся локально с базой данных Postgres.

## Тестирование
Запросы нужно отправлять по адерсу localhost и порту 8080, если запрос отправлятся снаружи docker контейнера; 6060 если запрос отправлятся изнутри docker контейнера.
## Первый маршрут
GET запрос с GUID пользователя, указанным в параметре запроса. Пример запроса в Postman: ![image](https://github.com/user-attachments/assets/1374d5f7-c770-43e8-89bf-7bcd798b789e)

Приложение создает два JWT токена - один Accesss, другой Refresh и взвращает их пользователю, указывая в response срок истечения токенов. Payload токенов содержит информацию о id и ip пользователя. Также приложение создает новую сессию в таблице sessions, где хранится информация о пользователе, bucrypt хеш Refresh токена и срок его истечения.
Пример OK ответа в Postman: ![image](https://github.com/user-attachments/assets/520cce8a-a2a4-498b-b4ed-53eff06eae2c)


## Второй маршрут
POST запрос с Refresh токеном, указанным в теле запроса. Например запроса в Postman: ![image](https://github.com/user-attachments/assets/81f6e766-d29d-4586-bdcd-74e66cc344d2)

Приложение валидирует Refresh токен, проверяет срок истечения сессии и сверяет ip адрес запроса с тем, который использовался при создании сессии, иммитируя отпраку сообщения на Email пользователя. В случае успеха создается новый JWT Access токен и отправлятся пользователю.

Пример OK ответа в Postman: ![image](https://github.com/user-attachments/assets/768fdd92-109b-455d-b5bb-d5c657e72431)

## Примечание
Структура таблиц в БД Postgres формируется при автоматической миграции при инициализации приложения. Таблица users содержит информацию о прользователях. В эту таблицу добавляются три пользователя. Их id можно использовать для тестирования.
1. 1716daab-5868-477e-9f51-0df2a0e925b7 
2. 655b8db4-0a6e-4dd8-82c7-49112ec15a29
3. bdaff134-3b88-4596-86e2-4c55e106b77e


Для у этих пользователей существуют сессии в таблице sessions, однако это не мешает создавать новые сессии с помощью первого маршрута, так как одна сессия связана с одним refresh токеном.
